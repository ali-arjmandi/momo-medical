@startuml
title POST /notifications/:id/confirm-for-user - User Confirmation Flow

actor Client
participant "Express App" as App
participant "Repository" as Repo
participant "Notification" as Notif

Client -> App: POST /notifications/:id/confirm-for-user\n{ userId }
activate App

App -> App: Validate userId in request body

alt userId missing
  App --> Client: 400 Bad Request\n{ error: "userId is required" }
  deactivate App
else userId provided
  App -> Repo: get(notificationId)
  activate Repo
  
  alt Notification not found
    Repo --> App: NotificationNotFoundError
    deactivate Repo
    App --> Client: 404 Not Found\n{ error }
    deactivate App
  else Notification found
    Repo --> App: notification
    deactivate Repo
    
    App -> Notif: confirmForUser({ userId })
    activate Notif
    
    Notif -> Notif: Find user by userId in users[]
    
    alt User not found
      Notif --> App: UserNotFoundError
      deactivate Notif
      App --> Client: 400 Bad Request\n{ error }
      deactivate App
    else User found
      Notif -> Notif: Create UserConfirmation\n(confirmedAt: new Date(),\n confirmedBy: user)
      Notif -> Notif: Store in userConfirmation
      Notif --> App: userConfirmation
      deactivate Notif
      
      App -> Repo: update(notification)
      activate Repo
      Repo --> App: updated notification
      deactivate Repo
      
      App -> App: Format response\n(confirmedAt: ISO string)
      App --> Client: 200 OK\n{ userConfirmation: {...} }
      deactivate App
    end
  end
end

@enduml
